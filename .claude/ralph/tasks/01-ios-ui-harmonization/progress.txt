# Ralph Progress Log
Started: 2026-01-28
Feature: 01-ios-ui-harmonization

## Codebase Patterns

### Design System Files (ALWAYS read these first)
- `ios/Pulpe/Shared/Design/DesignTokens.swift` — Spacing, CornerRadius, Card, FormField, Shadow, Opacity, Icon, Progress
- `ios/Pulpe/Shared/Extensions/Color+Pulpe.swift` — All colors with light/dark (financialIncome, financialExpense, financialSavings, financialOverBudget, errorPrimary, errorBackground, surfacePrimary, surfaceCard, pulpePrimary)
- `ios/Pulpe/Shared/Styles/Typography.swift` — PulpeTypography (heroTitle, headlineLarge, bodyLarge, amountHero, labelLarge, etc.)
- `ios/Pulpe/Shared/Extensions/View+Extensions.swift` — .pulpeCard(), .pulpeSectionHeader(), .loadingOverlay()
- `ios/Pulpe/Shared/Styles/AnimationConstants.swift` — typealias to DesignTokens.Animation (backward compat)

### Critical Constraints
- NEVER touch Shared/Components/CustomTabBar.swift
- ZERO hardcoded values: all colors → Color+Pulpe, all fonts → PulpeTypography, all spacing → DesignTokens.Spacing, all radius → DesignTokens.CornerRadius
- No .red, Color.red, .green, Color.green in views — use Color.financialOverBudget, Color.errorPrimary, Color.financialSavings
- No .white/.black — use DA semantic tokens (surfacePrimary, surfaceCard, textPrimary)
- No .stroke()/.border() on form inputs — use filled background (inputBackgroundSoft or surfaceCard)
- Dark mode: no pure #000 → use #1C1C1E (surfaceCard dark)
- Build check after EVERY story: xcodegen generate && xcodebuild build -scheme Pulpe -destination 'platform=iOS Simulator,name=iPhone 17 Pro Max' CODE_SIGNING_ALLOWED=NO

### Replacement Cheat Sheet
| Hardcoded | Replace with |
|-----------|-------------|
| `.red` (over-budget) | `Color.financialOverBudget` |
| `.red` (error) | `Color.errorPrimary` |
| `.green` (positive) | `Color.financialSavings` or `.pulpePrimary` |
| `.white` (text on primary) | `Color.textOnPrimary` (if exists) or `.white` only inside Color+Pulpe |
| `.white` (background) | `Color.surfacePrimary` or `Color.surfaceCard` |
| `.black` (text) | `Color.textPrimary` |
| `Font.system(size: X)` | `PulpeTypography.bodyLarge` / `.headlineMedium` / etc. |
| `.stroke()` on inputs | Remove — use filled background |
| `padding(16)` | `.padding(DesignTokens.Spacing.lg)` |
| `cornerRadius(12)` | Already tokenized via DesignTokens.CornerRadius |

### DA Piliers (for messaging tone)
1. Soulagement → Errors warm & reassuring, not punitive
2. Clarté → 3-level visual hierarchy, one main message per screen
3. Contrôle → Obvious CTAs, immediate feedback
4. Légèreté → Rounded corners, soft colors, fluid 200-300ms animations

---

## 2026-01-28 - US-001: Consolidate animation tokens into DesignTokens
- Added `DesignTokens.Animation` enum with durations (fast: 0.2, normal: 0.3, slow: 0.5), spring presets, easing, and step transitions
- Converted `AnimationConstants.swift` to a typealias (`PulpeAnimations = DesignTokens.Animation`) for backward compatibility
- Files changed: `DesignTokens.swift`, `AnimationConstants.swift`
- **Learnings:**
  - Must use `SwiftUI.Animation` as return type inside `DesignTokens.Animation` to avoid ambiguity with the enum name
  - PRD specified normal: 0.3 but existing code had 0.35 — used PRD value
  - 3 call sites use PulpeAnimations (OnboardingFlow, OnboardingProgressIndicator, OnboardingStepHeader) — all work via typealias
---

## 2026-01-28 - US-002: Add missing semantic color and surface tokens
- Added 8 new color tokens to Color+Pulpe.swift using `init(light:dark:)` with hex values from DA.md
- New tokens: surfacePrimary, surfaceCard, surfaceSecondary, textPrimary, textOnPrimary, errorPrimary, errorBackground, financialOverBudget
- Files changed: `Color+Pulpe.swift`
- **Learnings:**
  - DA.md specifies fond principal as #F6FFF0 (blanc verdâtre) and surfaces as #EBFFE6
  - financialOverBudget uses warm amber (#C27A00) not red, per DA pillar "Soulagement"
  - errorPrimary uses warm orange (#D4760A) not red, per DA "pas de rouge agressif"
  - No asset catalog colorsets were needed — `init(light:dark:)` with hex is sufficient
  - textOnPrimary is white/white since primary buttons are dark green
---

## 2026-01-28 - US-003: Verify and complete pulpeCard() and pulpeSectionHeader() modifiers
- Replaced unused `cardStyle()` and `sectionHeader()` with DA-compliant `pulpeCard()` and `pulpeSectionHeader()`
- `pulpeCard()`: padding(Spacing.lg), background(Color.surfaceCard), cornerRadius(CornerRadius.lg), shadow(Shadow.subtle)
- `pulpeSectionHeader()`: font(.headline), foregroundStyle(Color.textPrimary), full-width leading alignment
- Files changed: `View+Extensions.swift`
- **Learnings:**
  - The PRD notes said pulpeCard()/pulpeSectionHeader() already existed — they didn't. Only cardStyle()/sectionHeader() existed (unused, with hardcoded values)
  - Replaced them directly since grep confirmed zero call sites for cardStyle()/sectionHeader()
  - Both modifiers are simple extension functions (inherently stateless), no need for ViewModifier structs
---

## 2026-01-28 - US-004: Harmonize CurrencyField — remove stroke, use filled background
- Removed `.overlay(RoundedRectangle...stroke(...))` — no more border on input
- Changed `.background(.background)` → `Color.inputBackgroundSoft` (filled background)
- Changed `.padding()` → `.padding(DesignTokens.Spacing.lg)` (explicit token)
- Changed label `.font(.subheadline)` → `PulpeTypography.inputLabel`
- CurrencyText left unchanged (uses system fonts appropriately for read-only display)
- Files changed: `CurrencyField.swift`
- **Learnings:**
  - `.background(.background)` is a SwiftUI semantic that adapts to context, but DA requires explicit `inputBackgroundSoft` for form inputs
  - CurrencyField had minimal violations (only stroke + background) compared to what PRD notes suggested
  - The `effectiveFocus` visual feedback (stroke color change) was removed — filled background alone is sufficient per DA
---

## 2026-01-28 - US-005: Harmonize AddTransactionSheet — Form natif, tokens DA
- File was already well-harmonized from prior work (Form with .listRowBackground, DesignTokens.Spacing, Color.pulpePrimary, no hardcoded colors)
- Added PulpeTypography.labelLarge (size 15, semibold) and PulpeTypography.bodyLarge (size 17, regular) to Typography.swift
- Applied PulpeTypography.labelLarge to all 5 Form section headers (Montant, Montants rapides, Description, Type, Date)
- Applied PulpeTypography.bodyLarge to the TextField input
- Files changed: `Typography.swift`, `AddTransactionSheet.swift`
- **Learnings:**
  - labelLarge and bodyLarge were referenced in progress.txt header but never actually added — now they exist for future stories
  - Form section headers accept custom fonts via `.font()` on the Text view inside the header closure
  - AddTransactionSheet was already mostly DA-compliant — the prior US-004 CurrencyField harmonization covered the main input
---

## 2026-01-28 - US-006: Harmonize AddBudgetLineSheet — Form natif, tokens DA
- Added `.listRowBackground(Color.surfaceCard)` to all 3 Form sections (Description, Montant, Type)
- Added `PulpeTypography.labelLarge` to all section header Text views
- Added `PulpeTypography.bodyLarge` to the TextField
- Files changed: `AddBudgetLineSheet.swift`
- **Learnings:**
  - AddBudgetLineSheet was already very clean — no hardcoded colors, no .stroke(), no .border()
  - Only missing DA tokens were typography and listRowBackground, matching the US-005 pattern exactly
  - These form sheet harmonizations are straightforward when no hardcoded values exist
---

## 2026-01-28 - US-007/008/009/010: Harmonize remaining form sheets
- US-007 AddAllocatedTransactionSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (3 sections)
- US-008 EditTransactionSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (4 sections: Description, Montant, Type, Date)
- US-009 EditBudgetLineSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (3 sections)
- US-010 EditTemplateLineSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (3 sections)
- Files changed: `AddAllocatedTransactionSheet.swift`, `EditTransactionSheet.swift`, `EditBudgetLineSheet.swift`, `EditTemplateLineSheet.swift`
- **Learnings:**
  - All 4 form sheets followed the exact same pattern — no hardcoded colors, just missing typography and listRowBackground
  - The form sheet harmonization is now a repeatable pattern: labelLarge on headers, bodyLarge on TextFields, surfaceCard on listRowBackground
---

## 2026-01-28 - US-012: Harmonize CreateTemplateView — remove stroke/white/red, use tokens
- Replaced `.green`/`.red` balance color ternary with `Color.financialSavings`/`Color.financialOverBudget`
- Replaced `.red` on trash icon with `Color.errorPrimary`
- Replaced hardcoded `spacing: 4` with `DesignTokens.Spacing.xs` (2 instances: footer VStack, TemplateLineInputRow VStack)
- No .stroke(), .border(), .white, .black were present — file was mostly clean
- Files changed: `CreateTemplateView.swift`
- **Learnings:**
  - CreateTemplateView had very few violations (only .red/.green and hardcoded spacing)
  - The `.red` on a destructive trash button should use `Color.errorPrimary` (warm orange), not `Color.financialOverBudget` (amber) — errorPrimary is for UI error/destructive actions
  - Pattern: balance ternary `>= 0 ? .green : .red` → `>= 0 ? Color.financialSavings : Color.financialOverBudget`
---

## 2026-01-28 - US-013: Harmonize LoginView — replace red, white/black, Font.system(), hardcoded padding
- Replaced error banner: `Color.red.opacity(0.9)` background + `.white` text → `Color.errorBackground` background + `Color.errorPrimary` icon + `Color.textPrimary` text (warm, reassuring per DA Soulagement)
- Replaced all `.white` on buttons/ProgressView → `Color.textOnPrimary`
- Replaced all `Font.system()` (10 instances) with PulpeTypography tokens: brandTitle (36pt, new), onboardingSubtitle, inputLabel, bodyLarge, stepSubtitle, labelLarge, inputLabel
- Removed `.stroke()` overlays on email and password inputs (focus still indicated by shadow glow + scale effect)
- Replaced hardcoded spacing: 20→xl, 8→sm, 14→lg, 12→md, 16→lg, 4→xs, 18→lg, 24→xxl
- Layout-specific values (56, 44, 32, 40, 54 height, 14 cornerRadius, 24 cornerRadius) kept as-is — no matching tokens
- Added `PulpeTypography.brandTitle` = Font.system(size: 36, weight: .bold, design: .rounded)
- Files changed: `LoginView.swift`, `Typography.swift`
- **Learnings:**
  - Error banners: using `errorBackground` bg + `errorPrimary` icon is warmer than a solid errorPrimary background with white text
  - `.black.opacity()` in shadows is acceptable — DesignTokens.Shadow uses the same pattern internally
  - `.secondary` is a SwiftUI semantic color (adapts to light/dark), not a hardcoded color — acceptable to keep
  - Layout-specific padding (56pt top, 44pt bottom) should not be forced into spacing tokens — these are screen-level layout values
  - Focus indication via shadow glow (Color.inputFocusGlow) + subtle scale effect is sufficient without stroke overlay
---

## 2026-01-28 - US-014: Harmonize RegistrationStep — replace red/stroke, use tokens
- Removed all 3 `.overlay(RoundedRectangle...stroke())` on email, password, and confirmation inputs — replaced with filled background
- Replaced `.background(.background)` → `Color.inputBackgroundSoft` on all 3 inputs
- Replaced `.padding()` → `.padding(DesignTokens.Spacing.lg)` on all 3 inputs
- Password confirmation: mismatch state uses `Color.errorBackground` background instead of red stroke
- Replaced `.foregroundStyle(.red)` → `.foregroundStyle(Color.errorPrimary)` for mismatch error text
- Replaced `.font(.subheadline)` → `PulpeTypography.inputLabel` on all 3 labels
- Replaced `spacing: 20` → `DesignTokens.Spacing.xl`, `spacing: 4` → `DesignTokens.Spacing.xs`
- Replaced CheckboxToggleStyle `spacing: 12` → `DesignTokens.Spacing.md`
- Files changed: `RegistrationStep.swift`
- **Learnings:**
  - Error indication on inputs without stroke: use `Color.errorBackground` as background color when validation fails — visually distinct but not aggressive
  - `.secondary` foregroundStyle is a SwiftUI semantic — acceptable to keep (adapts to light/dark)
  - `.background(.background)` is SwiftUI semantic but DA requires explicit `inputBackgroundSoft` for consistency across all form inputs
  - RegistrationStep had more violations than PRD notes suggested — all 3 inputs had stroke overlays, not just the confirmation field
---

## 2026-01-28 - US-015: Harmonize remaining Onboarding steps — tokens DA, airy layout
- PersonalInfoStep: removed `.overlay(.stroke())`, replaced `.background(.background)` → `Color.inputBackgroundSoft`, `.padding()` → `DesignTokens.Spacing.lg`, `.font(.subheadline)` → `PulpeTypography.inputLabel`, `spacing: 8` → `DesignTokens.Spacing.sm`
- WelcomeStep: replaced `.foregroundStyle(.white)` → `Color.textOnPrimary`
- Other steps (Income, Housing, HealthInsurance, PhonePlan, Transport, LeasingCredit): already clean — delegate to CurrencyField (harmonized in US-004)
- OnboardingFlow: no hardcoded colors — uses Color.onboardingBackground, PulpeAnimations
- OnboardingState: pure logic, no colors at all
- Files changed: `PersonalInfoStep.swift`, `WelcomeStep.swift`
- **Learnings:**
  - PRD notes said "OnboardingState has .white" but it's a pure state/logic class with no UI code — no .white found
  - Most onboarding steps are thin wrappers around CurrencyField, which was already harmonized in US-004
  - PersonalInfoStep is the only step with its own TextField (not CurrencyField), so it's the only one that needed stroke removal
  - `.secondary` foregroundStyle on labels is a SwiftUI semantic (adapts to light/dark) — acceptable to keep
  - stepHealth color (red) kept as-is per acceptance criteria — intentional for health category visual distinction
---


# Ralph Progress Log
Started: 2026-01-28
Feature: 01-ios-ui-harmonization

## Codebase Patterns

### Design System Files (ALWAYS read these first)
- `ios/Pulpe/Shared/Design/DesignTokens.swift` — Spacing, CornerRadius, Card, FormField, Shadow, Opacity, Icon, Progress
- `ios/Pulpe/Shared/Extensions/Color+Pulpe.swift` — All colors with light/dark (financialIncome, financialExpense, financialSavings, financialOverBudget, errorPrimary, errorBackground, surfacePrimary, surfaceCard, pulpePrimary)
- `ios/Pulpe/Shared/Styles/Typography.swift` — PulpeTypography (heroTitle, headlineLarge, bodyLarge, amountHero, labelLarge, etc.)
- `ios/Pulpe/Shared/Extensions/View+Extensions.swift` — .pulpeCard(), .pulpeSectionHeader(), .loadingOverlay()
- `ios/Pulpe/Shared/Styles/AnimationConstants.swift` — typealias to DesignTokens.Animation (backward compat)

### Critical Constraints
- NEVER touch Shared/Components/CustomTabBar.swift
- ZERO hardcoded values: all colors → Color+Pulpe, all fonts → PulpeTypography, all spacing → DesignTokens.Spacing, all radius → DesignTokens.CornerRadius
- No .red, Color.red, .green, Color.green in views — use Color.financialOverBudget, Color.errorPrimary, Color.financialSavings
- No .white/.black — use DA semantic tokens (surfacePrimary, surfaceCard, textPrimary)
- No .stroke()/.border() on form inputs — use filled background (inputBackgroundSoft or surfaceCard)
- Dark mode: no pure #000 → use #1C1C1E (surfaceCard dark)
- Build check after EVERY story: xcodegen generate && xcodebuild build -scheme Pulpe -destination 'platform=iOS Simulator,name=iPhone 17 Pro Max' CODE_SIGNING_ALLOWED=NO

### Replacement Cheat Sheet
| Hardcoded | Replace with |
|-----------|-------------|
| `.red` (over-budget) | `Color.financialOverBudget` |
| `.red` (error) | `Color.errorPrimary` |
| `.green` (positive) | `Color.financialSavings` or `.pulpePrimary` |
| `.white` (text on primary) | `Color.textOnPrimary` (if exists) or `.white` only inside Color+Pulpe |
| `.white` (background) | `Color.surfacePrimary` or `Color.surfaceCard` |
| `.black` (text) | `Color.textPrimary` |
| `Font.system(size: X)` | `PulpeTypography.bodyLarge` / `.headlineMedium` / etc. |
| `.stroke()` on inputs | Remove — use filled background |
| `padding(16)` | `.padding(DesignTokens.Spacing.lg)` |
| `cornerRadius(12)` | Already tokenized via DesignTokens.CornerRadius |

### DA Piliers (for messaging tone)
1. Soulagement → Errors warm & reassuring, not punitive
2. Clarté → 3-level visual hierarchy, one main message per screen
3. Contrôle → Obvious CTAs, immediate feedback
4. Légèreté → Rounded corners, soft colors, fluid 200-300ms animations

---

## 2026-01-28 - US-001: Consolidate animation tokens into DesignTokens
- Added `DesignTokens.Animation` enum with durations (fast: 0.2, normal: 0.3, slow: 0.5), spring presets, easing, and step transitions
- Converted `AnimationConstants.swift` to a typealias (`PulpeAnimations = DesignTokens.Animation`) for backward compatibility
- Files changed: `DesignTokens.swift`, `AnimationConstants.swift`
- **Learnings:**
  - Must use `SwiftUI.Animation` as return type inside `DesignTokens.Animation` to avoid ambiguity with the enum name
  - PRD specified normal: 0.3 but existing code had 0.35 — used PRD value
  - 3 call sites use PulpeAnimations (OnboardingFlow, OnboardingProgressIndicator, OnboardingStepHeader) — all work via typealias
---

## 2026-01-28 - US-002: Add missing semantic color and surface tokens
- Added 8 new color tokens to Color+Pulpe.swift using `init(light:dark:)` with hex values from DA.md
- New tokens: surfacePrimary, surfaceCard, surfaceSecondary, textPrimary, textOnPrimary, errorPrimary, errorBackground, financialOverBudget
- Files changed: `Color+Pulpe.swift`
- **Learnings:**
  - DA.md specifies fond principal as #F6FFF0 (blanc verdâtre) and surfaces as #EBFFE6
  - financialOverBudget uses warm amber (#C27A00) not red, per DA pillar "Soulagement"
  - errorPrimary uses warm orange (#D4760A) not red, per DA "pas de rouge agressif"
  - No asset catalog colorsets were needed — `init(light:dark:)` with hex is sufficient
  - textOnPrimary is white/white since primary buttons are dark green
---

## 2026-01-28 - US-003: Verify and complete pulpeCard() and pulpeSectionHeader() modifiers
- Replaced unused `cardStyle()` and `sectionHeader()` with DA-compliant `pulpeCard()` and `pulpeSectionHeader()`
- `pulpeCard()`: padding(Spacing.lg), background(Color.surfaceCard), cornerRadius(CornerRadius.lg), shadow(Shadow.subtle)
- `pulpeSectionHeader()`: font(.headline), foregroundStyle(Color.textPrimary), full-width leading alignment
- Files changed: `View+Extensions.swift`
- **Learnings:**
  - The PRD notes said pulpeCard()/pulpeSectionHeader() already existed — they didn't. Only cardStyle()/sectionHeader() existed (unused, with hardcoded values)
  - Replaced them directly since grep confirmed zero call sites for cardStyle()/sectionHeader()
  - Both modifiers are simple extension functions (inherently stateless), no need for ViewModifier structs
---

## 2026-01-28 - US-004: Harmonize CurrencyField — remove stroke, use filled background
- Removed `.overlay(RoundedRectangle...stroke(...))` — no more border on input
- Changed `.background(.background)` → `Color.inputBackgroundSoft` (filled background)
- Changed `.padding()` → `.padding(DesignTokens.Spacing.lg)` (explicit token)
- Changed label `.font(.subheadline)` → `PulpeTypography.inputLabel`
- CurrencyText left unchanged (uses system fonts appropriately for read-only display)
- Files changed: `CurrencyField.swift`
- **Learnings:**
  - `.background(.background)` is a SwiftUI semantic that adapts to context, but DA requires explicit `inputBackgroundSoft` for form inputs
  - CurrencyField had minimal violations (only stroke + background) compared to what PRD notes suggested
  - The `effectiveFocus` visual feedback (stroke color change) was removed — filled background alone is sufficient per DA
---

## 2026-01-28 - US-005: Harmonize AddTransactionSheet — Form natif, tokens DA
- File was already well-harmonized from prior work (Form with .listRowBackground, DesignTokens.Spacing, Color.pulpePrimary, no hardcoded colors)
- Added PulpeTypography.labelLarge (size 15, semibold) and PulpeTypography.bodyLarge (size 17, regular) to Typography.swift
- Applied PulpeTypography.labelLarge to all 5 Form section headers (Montant, Montants rapides, Description, Type, Date)
- Applied PulpeTypography.bodyLarge to the TextField input
- Files changed: `Typography.swift`, `AddTransactionSheet.swift`
- **Learnings:**
  - labelLarge and bodyLarge were referenced in progress.txt header but never actually added — now they exist for future stories
  - Form section headers accept custom fonts via `.font()` on the Text view inside the header closure
  - AddTransactionSheet was already mostly DA-compliant — the prior US-004 CurrencyField harmonization covered the main input
---

## 2026-01-28 - US-006: Harmonize AddBudgetLineSheet — Form natif, tokens DA
- Added `.listRowBackground(Color.surfaceCard)` to all 3 Form sections (Description, Montant, Type)
- Added `PulpeTypography.labelLarge` to all section header Text views
- Added `PulpeTypography.bodyLarge` to the TextField
- Files changed: `AddBudgetLineSheet.swift`
- **Learnings:**
  - AddBudgetLineSheet was already very clean — no hardcoded colors, no .stroke(), no .border()
  - Only missing DA tokens were typography and listRowBackground, matching the US-005 pattern exactly
  - These form sheet harmonizations are straightforward when no hardcoded values exist
---

## 2026-01-28 - US-007/008/009/010: Harmonize remaining form sheets
- US-007 AddAllocatedTransactionSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (3 sections)
- US-008 EditTransactionSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (4 sections: Description, Montant, Type, Date)
- US-009 EditBudgetLineSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (3 sections)
- US-010 EditTemplateLineSheet: +labelLarge headers, +bodyLarge TextField, +listRowBackground (3 sections)
- Files changed: `AddAllocatedTransactionSheet.swift`, `EditTransactionSheet.swift`, `EditBudgetLineSheet.swift`, `EditTemplateLineSheet.swift`
- **Learnings:**
  - All 4 form sheets followed the exact same pattern — no hardcoded colors, just missing typography and listRowBackground
  - The form sheet harmonization is now a repeatable pattern: labelLarge on headers, bodyLarge on TextFields, surfaceCard on listRowBackground
---

## 2026-01-28 - US-012: Harmonize CreateTemplateView — remove stroke/white/red, use tokens
- Replaced `.green`/`.red` balance color ternary with `Color.financialSavings`/`Color.financialOverBudget`
- Replaced `.red` on trash icon with `Color.errorPrimary`
- Replaced hardcoded `spacing: 4` with `DesignTokens.Spacing.xs` (2 instances: footer VStack, TemplateLineInputRow VStack)
- No .stroke(), .border(), .white, .black were present — file was mostly clean
- Files changed: `CreateTemplateView.swift`
- **Learnings:**
  - CreateTemplateView had very few violations (only .red/.green and hardcoded spacing)
  - The `.red` on a destructive trash button should use `Color.errorPrimary` (warm orange), not `Color.financialOverBudget` (amber) — errorPrimary is for UI error/destructive actions
  - Pattern: balance ternary `>= 0 ? .green : .red` → `>= 0 ? Color.financialSavings : Color.financialOverBudget`
---

## 2026-01-28 - US-013: Harmonize LoginView — replace red, white/black, Font.system(), hardcoded padding
- Replaced error banner: `Color.red.opacity(0.9)` background + `.white` text → `Color.errorBackground` background + `Color.errorPrimary` icon + `Color.textPrimary` text (warm, reassuring per DA Soulagement)
- Replaced all `.white` on buttons/ProgressView → `Color.textOnPrimary`
- Replaced all `Font.system()` (10 instances) with PulpeTypography tokens: brandTitle (36pt, new), onboardingSubtitle, inputLabel, bodyLarge, stepSubtitle, labelLarge, inputLabel
- Removed `.stroke()` overlays on email and password inputs (focus still indicated by shadow glow + scale effect)
- Replaced hardcoded spacing: 20→xl, 8→sm, 14→lg, 12→md, 16→lg, 4→xs, 18→lg, 24→xxl
- Layout-specific values (56, 44, 32, 40, 54 height, 14 cornerRadius, 24 cornerRadius) kept as-is — no matching tokens
- Added `PulpeTypography.brandTitle` = Font.system(size: 36, weight: .bold, design: .rounded)
- Files changed: `LoginView.swift`, `Typography.swift`
- **Learnings:**
  - Error banners: using `errorBackground` bg + `errorPrimary` icon is warmer than a solid errorPrimary background with white text
  - `.black.opacity()` in shadows is acceptable — DesignTokens.Shadow uses the same pattern internally
  - `.secondary` is a SwiftUI semantic color (adapts to light/dark), not a hardcoded color — acceptable to keep
  - Layout-specific padding (56pt top, 44pt bottom) should not be forced into spacing tokens — these are screen-level layout values
  - Focus indication via shadow glow (Color.inputFocusGlow) + subtle scale effect is sufficient without stroke overlay
---

## 2026-01-28 - US-014: Harmonize RegistrationStep — replace red/stroke, use tokens
- Removed all 3 `.overlay(RoundedRectangle...stroke())` on email, password, and confirmation inputs — replaced with filled background
- Replaced `.background(.background)` → `Color.inputBackgroundSoft` on all 3 inputs
- Replaced `.padding()` → `.padding(DesignTokens.Spacing.lg)` on all 3 inputs
- Password confirmation: mismatch state uses `Color.errorBackground` background instead of red stroke
- Replaced `.foregroundStyle(.red)` → `.foregroundStyle(Color.errorPrimary)` for mismatch error text
- Replaced `.font(.subheadline)` → `PulpeTypography.inputLabel` on all 3 labels
- Replaced `spacing: 20` → `DesignTokens.Spacing.xl`, `spacing: 4` → `DesignTokens.Spacing.xs`
- Replaced CheckboxToggleStyle `spacing: 12` → `DesignTokens.Spacing.md`
- Files changed: `RegistrationStep.swift`
- **Learnings:**
  - Error indication on inputs without stroke: use `Color.errorBackground` as background color when validation fails — visually distinct but not aggressive
  - `.secondary` foregroundStyle is a SwiftUI semantic — acceptable to keep (adapts to light/dark)
  - `.background(.background)` is SwiftUI semantic but DA requires explicit `inputBackgroundSoft` for consistency across all form inputs
  - RegistrationStep had more violations than PRD notes suggested — all 3 inputs had stroke overlays, not just the confirmation field
---

## 2026-01-28 - US-015: Harmonize remaining Onboarding steps — tokens DA, airy layout
- PersonalInfoStep: removed `.overlay(.stroke())`, replaced `.background(.background)` → `Color.inputBackgroundSoft`, `.padding()` → `DesignTokens.Spacing.lg`, `.font(.subheadline)` → `PulpeTypography.inputLabel`, `spacing: 8` → `DesignTokens.Spacing.sm`
- WelcomeStep: replaced `.foregroundStyle(.white)` → `Color.textOnPrimary`
- Other steps (Income, Housing, HealthInsurance, PhonePlan, Transport, LeasingCredit): already clean — delegate to CurrencyField (harmonized in US-004)
- OnboardingFlow: no hardcoded colors — uses Color.onboardingBackground, PulpeAnimations
- OnboardingState: pure logic, no colors at all
- Files changed: `PersonalInfoStep.swift`, `WelcomeStep.swift`
- **Learnings:**
  - PRD notes said "OnboardingState has .white" but it's a pure state/logic class with no UI code — no .white found
  - Most onboarding steps are thin wrappers around CurrencyField, which was already harmonized in US-004
  - PersonalInfoStep is the only step with its own TextField (not CurrencyField), so it's the only one that needed stroke removal
  - `.secondary` foregroundStyle on labels is a SwiftUI semantic (adapts to light/dark) — acceptable to keep
  - stepHealth color (red) kept as-is per acceptance criteria — intentional for health category visual distinction
---

## 2026-01-28 - US-016: Harmonize OnboardingNavigationButtons — replace white, use tokens
- Replaced `.tint(.white)` → `.tint(Color.textOnPrimary)` on ProgressView
- Replaced `.foregroundStyle(.white)` → `.foregroundStyle(Color.textOnPrimary)` on button content
- Replaced `.font(.system(size: 14, weight: .semibold))` → `PulpeTypography.inputLabel` on arrow icon
- Replaced `.font(.system(size: 12, weight: .semibold))` → `PulpeTypography.inputHelper` on chevron icon
- Replaced hardcoded spacing: `12` → `DesignTokens.Spacing.md`, `8` → `.sm`, `4` → `.xs`
- Replaced `.padding(.horizontal, 24)` → `DesignTokens.Spacing.xxl`
- `.padding(.bottom, 32)` kept as-is — layout-specific value (no matching token)
- Button text already used PulpeTypography.buttonPrimary/buttonSecondary — no change needed
- Primary button already used Color.onboardingGradient — no change needed
- Files changed: `OnboardingNavigationButtons.swift`
- **Learnings:**
  - PulpeTypography.inputLabel (14pt semibold) is a good match for SF Symbol icon sizing on primary buttons
  - PulpeTypography.inputHelper (12pt medium) works for smaller SF Symbol icons — weight difference (medium vs semibold) is negligible for icons
  - This component was already partially harmonized (PulpeTypography on text, Color.textSecondaryOnboarding on back button) — only .white and spacing remained
---

## 2026-01-28 - US-017: Harmonize DashboardHeroCard — replace red/green with semantic colors
- Replaced `.red` → `Color.financialOverBudget` in progressColor (>=100%) and balanceColor (over-budget)
- Replaced `.green` → `Color.financialSavings` in progressColor (<80%) and statusMessage (<70%)
- Replaced `.orange` → `Color.financialOverBudget` in progressColor (80-99%) and statusMessage (>=85%) — warm amber serves as warning tone
- Refactored statusMessage tuple from `(text, color)` to `(text, color, icon)` to avoid `status.color == .green` comparison (custom Color instances can't be reliably compared with ==)
- Files changed: `DashboardHeroCard.swift`
- **Learnings:**
  - Custom Color instances (e.g., `Color.financialSavings`) can't be compared with `==` — avoid `color == .green` patterns. Use a separate field (enum, string, bool) for conditional logic
  - `.orange` for 80-99% warning state maps well to `Color.financialOverBudget` (warm amber) — both convey "approaching limit" without aggressive red
  - Font.system(size: 42) for the hero amount was left as-is — no matching PulpeTypography token exists yet (US-018 will likely add amountHero)
  - `.primary` (SwiftUI semantic) is acceptable for non-over-budget balance text — adapts correctly to light/dark
---

## 2026-01-28 - US-018: Harmonize HeroBalanceCard — replace red/green/white, fix Font.system()
- Replaced `.red` → `Color.financialOverBudget` (3 instances: progressColor over-budget, balanceColor, over-budget label)
- Replaced `.orange` → `Color.financialOverBudget` (warning state at >85%)
- Replaced `Font.system(size: 42, weight: .bold, design: .rounded)` → `PulpeTypography.amountHero` (new token)
- Replaced `Font.system(size: 16, weight: .bold, design: .rounded)` → `PulpeTypography.progressValue` (new token)
- Replaced `Font.system(size: 10, weight: .medium)` → `PulpeTypography.progressUnit` (new token)
- Replaced `Color(.secondarySystemGroupedBackground)` → `Color.surfaceCard` (DA verdâtre surface)
- Replaced hardcoded spacing: `20` → `DesignTokens.Spacing.xl`, `24` → `.xxl`, `8` → `.sm`
- Circle `.stroke()` on progress indicator kept as-is — it's a progress ring, not a form input border
- Files changed: `HeroBalanceCard.swift`, `Typography.swift`
- **Learnings:**
  - Circle `.stroke()` for progress indicators is acceptable — the "no .stroke()" rule applies only to form input borders, not decorative/functional UI elements
  - `Color(.secondarySystemGroupedBackground)` is a UIKit system color — replaced with `Color.surfaceCard` for DA consistency (verdâtre tint)
  - `.secondary` (SwiftUI semantic) on labels and `.primary` on non-error text are acceptable — they adapt to light/dark mode correctly
  - `.caption` and `.subheadline` system fonts on stat labels are acceptable — no PulpeTypography equivalent needed for standard body text in data-dense areas
  - `amountHero` (42pt bold rounded), `progressValue` (16pt bold rounded), `progressUnit` (10pt medium) added to PulpeTypography for reuse across dashboard hero components
---

## 2026-01-28 - US-019: Harmonize Dashboard secondary cards (TopSpending, Trends, YearOverview, RecentTransactions)
- TopSpendingCard: replaced `Color(.secondarySystemGroupedBackground)` → `Color.surfaceCard`, replaced hardcoded spacing (12→md, 16→lg)
- YearOverviewCard: replaced `.red` → `Color.financialOverBudget` for negative rollover, replaced system background → `Color.surfaceCard`, replaced spacing (12→md, 8→sm, 16→lg)
- TrendsCard: replaced `.orange`/`.green` variation colors → `Color.financialOverBudget`/`Color.financialSavings`, replaced system background → `Color.surfaceCard` (both TrendsCard and TrendsEmptyState), replaced spacing (16→lg, 12→md, 20→xl, 4→xs, 8→sm)
- RecentTransactionsCard: replaced system background → `Color.surfaceCard`, replaced spacing (12→md, 8→sm, 16→lg)
- Files changed: `TopSpendingCard.swift`, `YearOverviewCard.swift`, `TrendsCard.swift`, `RecentTransactionsCard.swift`
- **Learnings:**
  - `Color(.secondarySystemGroupedBackground)` is a UIKit system color — consistently replaced with `Color.surfaceCard` across all dashboard cards for DA verdâtre tint
  - `.padding(.vertical, 14)` has no exact spacing token match (between md=12 and lg=16) — kept as-is as a layout-specific value
  - `.primary`, `.secondary`, `.tertiary` are SwiftUI semantic colors that adapt to light/dark — acceptable to keep
  - `.caption`, `.subheadline`, `.title2`, `.title3` system fonts in data-display contexts (not inputs or headers) are acceptable — these are standard body text
  - `spacing: 2` and `spacing: 6` are too small/specific for DesignTokens.Spacing tokens — kept as-is
  - TrendsCard variation label `.orange`/`.green` maps to `financialOverBudget`/`financialSavings` — increase=warm amber (spending up), decrease=green (spending down)
  - RecentTransactionsCard uses `transaction.kind.color` from the model — this is already semantic and doesn't need replacement
---

## 2026-01-28 - US-020: Harmonize Dashboard alert components (AlertsSection, InlineAlertsView, RealizedBalanceSheet)
- AlertsSection: replaced `.orange` → `Color.financialOverBudget` on header icon, replaced `.red`/`.orange` → `Color.financialOverBudget` in AlertRow (both over-budget and warning use warm amber), replaced spacing `12`→`md`, `4`→`xs`, `8`→`sm`
- InlineAlertsView: replaced `.orange` → `Color.financialOverBudget` on icon, replaced `.red`/`.orange` → `Color.financialOverBudget` for percentage text color, replaced `Color(.secondarySystemGroupedBackground)` → `Color.surfaceCard`, replaced spacing `4`→`xs`, `16`→`lg`, `12`→`md`
- RealizedBalanceSheet: replaced `.red` → `Color.financialOverBudget` (negative balance, badge), `.green`/`Color.green` → `Color.financialSavings`/`Color.financialSavings` (positive badge), `Color(.systemGroupedBackground)` → `Color.surfacePrimary`, `Color(.secondarySystemGroupedBackground)` → `Color.surfaceCard` (2x), `cornerRadius: 16` → `DesignTokens.CornerRadius.lg` (2x), `cornerRadius: 12` → `DesignTokens.CornerRadius.md`, spacing `24`→`xxl`, `16`→`lg`, `20`→`xl`, `12`→`md`, `4`→`xs`, `8`→`sm`
- Files changed: `AlertsSection.swift`, `InlineAlertsView.swift`, `RealizedBalanceSheet.swift`
- **Learnings:**
  - AlertsSection AlertRow had `.red`/`.orange` ternary for over-budget vs warning — simplified to `Color.financialOverBudget` for both since all alerts are ≥80% (both states warrant warm amber tone)
  - `Color(.systemGroupedBackground)` (UIKit primary bg) → `Color.surfacePrimary` (DA verdâtre), `Color(.secondarySystemGroupedBackground)` (UIKit secondary bg) → `Color.surfaceCard` — consistent replacement pattern
  - `.yellow` on decorative lightbulb icon and tip background is acceptable — it's a standard iconographic color for "tip/idea", not a financial indicator
  - `spacing: 6` and `.padding(.vertical, 6)` kept as-is — no matching DesignTokens.Spacing token (between xs=4 and sm=8)
  - RealizedBalanceSheet status message "on y remédie ?" already uses warm reassuring tone per DA Soulagement — no text change needed
  - `Font.system(size: 40, weight: .bold, design: .rounded)` on balance amount left as-is — `amountHero` is 42pt and this is 40pt, close but different. Layout-specific hero size.
---

## 2026-01-28 - US-021: Harmonize Dashboard lists (RecurringExpenses, OneTimeExpenses, LinkedTransactions, UncheckedTransactions)
- RecurringExpensesList (BudgetLineRow): replaced `.red`→`Color.financialOverBudget` (consumptionColor over-budget), `.orange`→`Color.financialOverBudget` (consumptionColor near-limit), `.red`→`Color.financialOverBudget` (remainingColor negative). Swipe delete `.tint(.red)`→`Color.errorPrimary`, undo `.tint(.orange)`→`Color.financialOverBudget`
- OneTimeExpensesList (TransactionSection): swipe delete `.tint(.red)`→`Color.errorPrimary`, undo `.tint(.orange)`→`Color.financialOverBudget`
- LinkedTransactionsSheet: `.red`→`Color.financialOverBudget` (remainingColor, progressColor), `Color(.systemGroupedBackground)`→`Color.surfacePrimary`, `Color(.secondarySystemGroupedBackground)`→`Color.surfaceCard` (4 instances), `.red.opacity(0.8)`→`Color.errorPrimary` (trash icon), `cornerRadius: 12`→`DesignTokens.CornerRadius.md` (2), spacing `20`→`xl`, `12`→`md`, `8`→`sm`, `16`→`lg`
- UncheckedTransactionsSection: `.orange`→`Color.financialOverBudget` (header icon, indicator icon), `Circle.stroke(Color.orange)`→`Circle.fill(Color.financialOverBudget.opacity(badgeBackground))` — replaced stroke with filled background per DA
- Files changed: `RecurringExpensesList.swift`, `OneTimeExpensesList.swift`, `LinkedTransactionsSheet.swift`, `UncheckedTransactionsSection.swift`
- **Learnings:**
  - Swipe action `.tint(.red)` for destructive actions → `Color.errorPrimary` (warm orange). SwiftUI accepts custom Color for `.tint()` on swipe buttons
  - Swipe action `.tint(.orange)` for undo/toggle → `Color.financialOverBudget` (warm amber) — semantically maps to "action needed" state
  - `Color(.systemGroupedBackground)` (UIKit primary grouped bg) → `Color.surfacePrimary` (DA verdâtre), consistent with US-020 pattern
  - UncheckedTransactionRow had `Circle.stroke(Color.orange)` as unchecked indicator — replaced with filled circle (`Color.financialOverBudget.opacity(badgeBackground)`) to match the filled-circle pattern used in BudgetLineRow and TransactionRow
  - `.padding(.vertical, 14)` has no exact spacing token match (between md=12 and lg=16) — kept as-is as layout-specific value, consistent with US-019 decision
  - `spacing: 2`, `spacing: 3`, `spacing: 6` are too granular for DesignTokens.Spacing — kept as-is
  - `.font(.system(.body, design: .rounded, weight: .medium))` and similar system text styles in list rows are acceptable — these are standard body text, not input or header typography
---

## 2026-01-28 - US-022: Harmonize BudgetListView and BudgetDetailsView — replace red, use tokens
- BudgetListView: replaced `.red` → `Color.financialOverBudget` in `RemainingStatus.negative`, replaced `Color(.secondarySystemGroupedBackground)` → `Color.surfaceCard` (BudgetMonthCard non-current background), replaced `Color(.tertiarySystemGroupedBackground)` → `Color.surfaceCard` (EmptyMonthCard background)
- BudgetDetailsView (RolloverInfoRow): replaced `.green`/`.red` → `Color.financialSavings`/`Color.financialOverBudget` (icon foreground + amount text, 2 instances each), replaced `Color.green`/`Color.red` → semantic colors in background fill, replaced `cornerRadius: 12` → `DesignTokens.CornerRadius.md`, replaced `spacing: 12` → `DesignTokens.Spacing.md`
- BudgetDetailsView (content): replaced `Color(.systemGroupedBackground)` → `Color.surfacePrimary` (list background)
- CheckedFilterPicker: already clean — segmented Picker with no hardcoded colors, no changes needed
- Files changed: `BudgetListView.swift`, `BudgetDetailsView.swift`
- **Learnings:**
  - Card `.stroke()` overlay for visual selection indicators (e.g., current month border) is acceptable — the "no .stroke()" rule applies to form input borders only, consistent with US-018 circle progress ring decision
  - `Color(.tertiarySystemGroupedBackground)` (UIKit tertiary grouped bg) → `Color.surfaceCard` — same replacement as `secondarySystemGroupedBackground`, the tertiary distinction is handled via opacity modifier
  - `.padding(.vertical, 14)` and `.padding(.horizontal, 8)` in grid cards kept as-is — layout-specific values with no exact token match, consistent with previous decisions
  - `.font(.system(.subheadline, design: .rounded, weight: .semibold))` and similar text styles in list/grid cards are standard body text — no PulpeTypography replacement needed
  - CheckedFilterPicker uses `.pickerStyle(.segmented)` which manages its own styling — no DA harmonization required
  - `spacing: 2`, `spacing: 6`, `spacing: 10` in grid and card layouts kept as-is — too granular for DesignTokens.Spacing
---


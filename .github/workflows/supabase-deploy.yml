# name: ğŸš€ Deploy Supabase Migrations
#
# on:
#   push:
#     branches: [main]
#     paths:
#       - 'backend-nest/supabase/migrations/**'
#   workflow_dispatch: # Permet le dÃ©clenchement manuel
#
# # Ã‰viter les runs multiples pour la mÃªme ref
# concurrency:
#   group: ${{ github.workflow }}-${{ github.ref }}
#   cancel-in-progress: false # Ne pas annuler les dÃ©ploiements en cours
#
# # SÃ©curitÃ© : permissions minimales
# permissions:
#   contents: read # Read-only, pas de commit automatique
#
# # Variables globales (cohÃ©rent avec le CI existant)
# env:
#   NODE_VERSION: "22"
#   PNPM_VERSION: "10.12.1"
#   BUN_VERSION: "1.2.17"
#
# jobs:
#   deploy-migrations:
#     name: ğŸ—„ï¸ Deploy Database Migrations
#     runs-on: ubuntu-latest
#     timeout-minutes: 10
#
#     steps:
#       - name: ğŸ“¥ Checkout
#         uses: actions/checkout@v4
#
#       - name: ğŸ—„ï¸ Setup Supabase CLI
#         uses: supabase/setup-cli@v1
#         with:
#           version: latest
#
#       - name: ğŸ”— Link to Production Project
#         working-directory: backend-nest
#         env:
#           SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
#           SUPABASE_PROJECT_ID: ${{ secrets.PRODUCTION_PROJECT_ID }}
#         run: |
#           echo "ğŸ”— Linking to production project..."
#           supabase link --project-ref $SUPABASE_PROJECT_ID
#
#       - name: ğŸš€ Deploy Migrations to Production
#         working-directory: backend-nest
#         env:
#           SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
#           SUPABASE_DB_PASSWORD: ${{ secrets.PRODUCTION_DB_PASSWORD }}
#         run: |
#           echo "ğŸš€ Deploying migrations to production..."
#           # Workaround pour le problÃ¨me de prompt interactif (issue connue)
#           yes | supabase db push
#           echo "âœ… Migrations deployed successfully"
#
#       - name: ğŸ“Š Deployment Summary
#         if: always()
#         run: |
#           echo "======================================"
#           echo "ğŸ“Š Migration Deployment Summary"
#           echo "======================================"
#           echo "Branch: ${{ github.ref_name }}"
#           echo "Commit: ${{ github.sha }}"
#           echo "Time: $(date)"
#           echo "======================================"
#           echo ""
#           echo "âš ï¸  REMINDER: Update your local types with:"
#           echo "    cd backend-nest && bun run generate-types"
#           echo "    cd .. && pnpm quality:fix"
#           echo "======================================"

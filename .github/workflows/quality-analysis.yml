name: 📊 Quality Analysis

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

# TEMPORARILY DISABLED - uncomment when fixed
# Workflow disabled until we fix the environment issues
jobs:
  disabled:
    name: 🚫 Quality Analysis Temporarily Disabled
    runs-on: ubuntu-latest
    if: false # This disables the entire workflow
    steps:
      - name: 📝 Disabled Notice
        run: |
          echo "Quality analysis workflow is temporarily disabled"
          echo "Re-enable by removing 'if: false' condition"

  # bundle-analysis:
  #   name: 📦 Bundle Analysis
  #   runs-on: ubuntu-latest
  #   if: github.event_name == 'pull_request'
  #   steps:
  #     - name: 📦 Checkout
  #       uses: actions/checkout@v4

  #     - name: 📦 Setup pnpm
  #       uses: pnpm/action-setup@v4
  #       with:
  #         version: 10.12.1

  #     - name: 📦 Setup Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: "22"
  #         cache: "pnpm"

  #     - name: 📦 Install dependencies
  #       run: pnpm install --frozen-lockfile

  #     - name: 🔨 Build shared packages
  #       run: pnpm run build:shared

  #     - name: 🔨 Build frontend with stats
  #       run: |
  #         cd frontend
  #         pnpm run ng build -- --stats-json --output-hashing=none --named-chunks

  #     - name: 📊 Archive bundle stats
  #       uses: actions/upload-artifact@v4
  #       with:
  #         name: bundle-stats
  #         path: frontend/dist/webapp/stats.json
  #         retention-days: 7

  # dependency-analysis:
  #   name: 🔍 Dependency Analysis
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: 📦 Checkout
  #       uses: actions/checkout@v4

  #     - name: 📦 Setup pnpm
  #       uses: pnpm/action-setup@v4
  #       with:
  #         version: 10.12.1

  #     - name: 📦 Setup Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: "22"
  #         cache: "pnpm"

  #     - name: 📦 Install dependencies
  #       run: pnpm install --frozen-lockfile

  #     - name: 🔍 Create deps directory
  #       run: mkdir -p frontend/deps/webapp

  #     - name: 🔍 Analyze dependencies
  #       run: |
  #         cd frontend
  #         npx madge projects/webapp/src/main.ts --ts-config projects/webapp/tsconfig.app.json --image ./deps/webapp/dependencies.png --circular

  #     - name: 📊 Upload dependency graph
  #       uses: actions/upload-artifact@v4
  #       with:
  #         name: dependency-graph
  #         path: frontend/deps/
  #         retention-days: 7

  # coverage-report:
  #   name: 📊 Coverage Report
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: 📦 Checkout
  #       uses: actions/checkout@v4

  #     - name: 📦 Setup Bun
  #       uses: oven-sh/setup-bun@v2
  #       with:
  #         bun-version: latest

  #     - name: 📦 Setup pnpm
  #       uses: pnpm/action-setup@v4
  #       with:
  #         version: 10.12.1

  #     - name: 📦 Setup Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: "22"
  #         cache: "pnpm"

  #     - name: 📦 Install dependencies
  #       run: pnpm install --frozen-lockfile

  #     - name: 🔨 Build shared packages
  #       run: pnpm run build:shared

  #     - name: 🧪 Run frontend tests
  #       run: |
  #         cd frontend
  #         pnpm run test:vitest:run

  #     - name: 🧪 Run backend tests with coverage
  #       run: |
  #         cd backend-nest
  #         bun run test:coverage

  #     - name: 📊 Archive coverage reports
  #       uses: actions/upload-artifact@v4
  #       with:
  #         name: coverage-reports
  #         path: |
  #           ./frontend/coverage/
  #           ./backend-nest/coverage/
  #         retention-days: 14
